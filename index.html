<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VAF AI Game Generator â€” From Prompt to Playable</title>
  <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; frame-src *; connect-src *;">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:      #000000;
      --bg2:     #0a0a0a;
      --bg3:     #111113;
      --border:  rgba(255,255,255,0.07);
      --accent:  #7c3aed;
      --gold:    #d4af37;
      --gold2:   #c4a35a;
      --text:    #f4f4f5;
      --muted:   #71717a;
      --white:   #ffffff;
      --grad:    linear-gradient(135deg, #7c3aed 0%, #d4af37 100%);
    }

    html { scroll-behavior: smooth; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      font-size: 16px;
      line-height: 1.6;
      overflow-x: hidden;
    }
    a { color: inherit; text-decoration: none; }
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 3px; }

    /* â”€â”€ NAV â”€â”€ */
    nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0.85rem 2rem;
      background: rgba(0,0,0,0.92);
      border-bottom: 1px solid rgba(212,175,55,0.15);
    }
    nav::after {
      content: '';
      position: absolute; bottom: -2px; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, #d4af37, #7c3aed, #c4a35a, transparent);
    }
    .nav-logo {
      font-size: 1.05rem; font-weight: 800; letter-spacing: -0.02em;
      background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .nav-links { display: flex; gap: 1.5rem; list-style: none; align-items: center; }
    .nav-links a { font-size: 0.85rem; color: var(--muted); transition: color 0.2s; }
    .nav-links a:hover { color: var(--white); }
    .nav-cta {
      background: var(--grad); color: #fff !important;
      padding: 0.45rem 1.1rem; border-radius: 8px;
      font-weight: 700; font-size: 0.85rem !important;
    }
    @media (max-width: 600px) { .nav-links { display: none; } }

    /* â”€â”€ MATRIX BG â”€â”€ */
    #bg-matrix {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: 0; pointer-events: none; opacity: 0.3;
    }

    /* â”€â”€ HERO â”€â”€ */
    #hero {
      position: relative; z-index: 1;
      min-height: 100vh;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 7rem 1.5rem 3rem;
    }

    .hero-inner {
      width: 100%; max-width: 860px;
      display: flex; flex-direction: column; align-items: center;
      gap: 1.5rem; text-align: center;
    }

    .hero-badge {
      display: inline-block;
      background: rgba(124,58,237,0.15);
      border: 1px solid rgba(124,58,237,0.4);
      color: var(--gold2);
      font-size: 0.75rem; font-weight: 700;
      letter-spacing: 0.1em; text-transform: uppercase;
      padding: 0.3rem 1rem; border-radius: 100px;
      font-family: 'Courier New', monospace;
    }
    .hero-badge::before { content: '> '; color: var(--gold); }

    #hero h1 {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 900; line-height: 1.1; letter-spacing: -0.03em;
      background: linear-gradient(180deg, #ffffff 0%, #a1a1aa 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    .hero-sub {
      font-size: 1.05rem; color: #a1a1aa; max-width: 560px;
    }

    /* â”€â”€ INLINE STUDIO BOX â”€â”€ */
    .studio-box {
      width: 100%; max-width: 640px;
      background: rgba(9,9,11,0.95);
      border: 1px solid rgba(124,58,237,0.5);
      border-radius: 20px;
      padding: 1.75rem;
      position: relative;
      box-shadow: 0 0 40px rgba(124,58,237,0.2), 0 0 80px rgba(212,175,55,0.08);
    }
    .studio-box::before {
      content: '';
      position: absolute; inset: -1px; border-radius: 21px;
      background: linear-gradient(135deg, rgba(124,58,237,0.7), rgba(212,175,55,0.7), rgba(124,58,237,0.7));
      background-size: 300% 300%;
      animation: borderGlow 3s linear infinite;
      z-index: -1; opacity: 0.5;
    }
    @keyframes borderGlow {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .studio-title {
      font-size: 0.72rem; font-weight: 700;
      letter-spacing: 0.12em; text-transform: uppercase;
      color: var(--gold2); margin-bottom: 1rem;
      font-family: 'Courier New', monospace;
    }
    .studio-title::before { content: '// '; opacity: 0.5; }

    /* Example chips */
    .example-chips {
      display: flex; flex-wrap: wrap; gap: 0.45rem;
      margin-bottom: 1rem;
    }
    .chip {
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      border-radius: 100px;
      padding: 0.3rem 0.75rem;
      font-size: 0.78rem; color: var(--muted);
      cursor: pointer; transition: all 0.15s;
      white-space: nowrap;
    }
    .chip:hover {
      border-color: rgba(196,163,90,0.5);
      color: var(--gold2);
      background: rgba(212,175,55,0.05);
    }

    .concept-textarea {
      width: 100%;
      background: rgba(0,0,0,0.6);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 0.95rem;
      padding: 0.85rem 1rem;
      font-family: inherit;
      resize: none;
      transition: border-color 0.2s;
      outline: none;
      min-height: 80px;
      margin-bottom: 0.85rem;
    }
    .concept-textarea:focus { border-color: var(--gold2); }
    .concept-textarea::placeholder { color: var(--muted); }

    .studio-footer {
      display: flex; align-items: center; justify-content: space-between;
      gap: 1rem; flex-wrap: wrap;
    }

    .credit-badge {
      font-size: 0.8rem; color: var(--muted);
      display: flex; align-items: center; gap: 0.35rem;
    }
    .credit-badge strong { color: var(--gold2); font-size: 1rem; }

    .generate-btn {
      background: var(--grad);
      color: #fff; border: none;
      border-radius: 10px;
      font-size: 0.95rem; font-weight: 700;
      padding: 0.75rem 2rem;
      cursor: pointer; transition: opacity 0.2s;
      white-space: nowrap;
    }
    .generate-btn:hover { opacity: 0.88; }
    .generate-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    /* â”€â”€â”€ TIER SELECTOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tier-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.6rem;
      margin-bottom: 1rem;
    }
    .tier-card {
      border: 1.5px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 0.65rem 0.5rem;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      background: rgba(255,255,255,0.03);
      position: relative;
    }
    .tier-card:hover { border-color: rgba(212,175,55,0.5); background: rgba(212,175,55,0.06); }
    .tier-card.selected {
      border-color: var(--gold2);
      background: rgba(212,175,55,0.12);
      box-shadow: 0 0 12px rgba(212,175,55,0.2);
    }
    .tier-card .tier-emoji { font-size: 1.4rem; display: block; margin-bottom: 0.25rem; }
    .tier-card .tier-name  { font-size: 0.72rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--white); }
    .tier-card .tier-cost  { font-size: 0.82rem; color: var(--gold2); font-weight: 700; margin: 0.15rem 0; }
    .tier-card .tier-desc  { font-size: 0.65rem; color: var(--muted); line-height: 1.35; }
    .tier-card .tier-badge {
      position: absolute; top: -8px; left: 50%; transform: translateX(-50%);
      background: var(--grad); color: #fff;
      font-size: 0.55rem; font-weight: 800; letter-spacing: 0.1em;
      padding: 2px 7px; border-radius: 20px; white-space: nowrap;
      display: none;
    }
    .tier-card.selected .tier-badge { display: block; }


    /* Complexity warn */
    .complexity-warn {
      display: none;
      background: rgba(212,175,55,0.07);
      border: 1px solid rgba(212,175,55,0.3);
      border-radius: 10px; padding: 0.75rem 1rem;
      margin-bottom: 0.85rem; font-size: 0.85rem;
    }
    .complexity-warn.visible { display: block; }
    .complexity-warn strong { color: var(--gold); display: block; margin-bottom: 0.25rem; }
    .complexity-warn p { color: #c4c4c8; }

    /* Error box */
    .error-box {
      display: none;
      background: rgba(239,68,68,0.08);
      border: 1px solid rgba(239,68,68,0.3);
      border-radius: 10px; padding: 0.75rem 1rem;
      color: #fca5a5; font-size: 0.88rem;
      margin-bottom: 0.85rem;
    }
    .error-box.visible { display: block; }

    /* Loading state (inside studio-box) */
    .gen-loading {
      display: none; flex-direction: column;
      align-items: center; gap: 1rem;
      padding: 1.5rem 0; text-align: center;
    }
    .gen-loading.visible { display: flex; }
    .spinner {
      width: 44px; height: 44px;
      border: 3px solid rgba(124,58,237,0.2);
      border-top-color: var(--gold2);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .gen-loading strong { color: var(--white); display: block; }
    .gen-loading p { color: var(--muted); font-size: 0.88rem; }

    /* Result state */
    .result-panel { display: none; }
    .result-panel.visible { display: block; }

    .result-meta {
      display: flex; gap: 0.6rem; flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .meta-badge {
      background: var(--bg); border: 1px solid var(--border);
      border-radius: 8px; padding: 0.25rem 0.65rem;
      font-size: 0.75rem; color: var(--muted);
    }
    .meta-badge span { color: var(--white); font-weight: 700; }

    .game-preview-box {
      width: 100%; height: 260px;
      border: 1px solid var(--border); border-radius: 12px;
      background: linear-gradient(135deg, rgba(124,58,237,0.08), rgba(212,175,55,0.05));
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      gap: 0.75rem; margin-bottom: 1rem;
    }
    .game-preview-box .play-icon { font-size: 3rem; }

    .result-actions {
      display: flex; gap: 0.6rem; flex-wrap: wrap;
      margin-bottom: 0;
    }
    .result-actions button {
      flex: 1; padding: 0.6rem 0.75rem;
      border-radius: 9px; font-weight: 600; font-size: 0.85rem;
      cursor: pointer; transition: all 0.2s;
      border: 1px solid var(--border);
      background: var(--bg3); color: var(--text);
      min-width: 80px;
    }
    .result-actions button:hover { border-color: var(--gold2); color: var(--white); }
    .result-actions button.act-primary {
      background: var(--grad); border: none; color: #fff;
    }
    .result-actions button.act-publish {
      background: rgba(212,175,55,0.1);
      border-color: rgba(212,175,55,0.35); color: var(--gold);
    }

    /* Publish panel */
    .publish-panel {
      display: none; margin-top: 1rem;
      border-top: 1px solid var(--border); padding-top: 1rem;
    }
    .publish-panel.visible { display: block; }
    .pub-input {
      width: 100%; background: var(--bg);
      border: 1px solid var(--border); border-radius: 9px;
      color: var(--text); font-size: 0.9rem;
      padding: 0.65rem 0.9rem; font-family: inherit;
      outline: none; margin-bottom: 0.6rem;
      transition: border-color 0.2s;
    }
    .pub-input:focus { border-color: var(--gold2); }
    .pub-success {
      display: none;
      background: rgba(212,175,55,0.07);
      border: 1px solid rgba(212,175,55,0.35);
      border-radius: 10px; padding: 0.85rem 1rem;
      text-align: center; margin-top: 0.5rem;
    }
    .pub-success.visible { display: block; }
    .pub-success p { color: var(--gold); font-size: 0.88rem; margin-bottom: 0.35rem; }
    .pub-link { font-size: 0.78rem; color: var(--muted); word-break: break-all; font-family: monospace; }

    /* Refine panel */
    .refine-panel {
      display: none; margin-top: 1rem;
      border-top: 1px solid var(--border); padding-top: 1rem;
    }
    .refine-panel.visible { display: block; }

    /* â”€â”€ GALLERY â”€â”€ */
    #gallery {
      position: relative; z-index: 1;
      padding: 4rem 2rem;
      max-width: 1200px; margin: 0 auto;
    }

    .gallery-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;
    }
    .gallery-header h2 {
      font-size: clamp(1.4rem, 3vw, 2rem);
      font-weight: 800; letter-spacing: -0.02em;
    }
    .gallery-header h2 span {
      background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .btn-refresh {
      background: transparent; border: 1px solid var(--border);
      border-radius: 8px; color: var(--muted);
      padding: 0.45rem 1rem; font-size: 0.82rem; cursor: pointer;
      transition: all 0.2s;
    }
    .btn-refresh:hover { border-color: var(--gold2); color: var(--white); }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 1.1rem;
    }

    .gallery-card {
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 14px; overflow: hidden;
      transition: border-color 0.2s, transform 0.2s;
    }
    .gallery-card:hover {
      border-color: rgba(212,175,55,0.4);
      transform: translateY(-3px);
      box-shadow: 0 8px 32px rgba(124,58,237,0.12);
    }

    .gallery-thumb {
      height: 120px;
      background: var(--grad);
      display: flex; align-items: center; justify-content: center;
      font-size: 3rem; cursor: pointer; position: relative; overflow: hidden;
    }
    .gallery-thumb::after {
      content: 'â–¶ Gioca';
      position: absolute; inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.9rem; font-weight: 700; color: #fff;
      opacity: 0; transition: opacity 0.2s;
      font-family: inherit;
    }
    .gallery-thumb:hover::after { opacity: 1; }

    .gallery-body { padding: 0.9rem 1rem; }
    .gallery-card h3 {
      font-size: 0.9rem; color: var(--white); margin-bottom: 0.3rem;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .gallery-card p {
      font-size: 0.78rem; color: var(--muted); margin-bottom: 0.7rem;
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }

    .gallery-actions { display: flex; gap: 0.4rem; }
    .gallery-actions a, .gallery-actions button {
      flex: 1; padding: 0.4rem 0.5rem;
      border-radius: 7px; font-weight: 600; font-size: 0.75rem;
      cursor: pointer; text-align: center; transition: all 0.2s;
      display: inline-flex; align-items: center; justify-content: center;
    }
    .btn-play {
      background: var(--grad); color: #fff; border: none; text-decoration: none;
    }
    .btn-remix {
      background: rgba(212,175,55,0.08);
      border: 1px solid rgba(212,175,55,0.28); color: var(--gold);
    }
    .btn-remix:hover { background: rgba(212,175,55,0.18); }

    .gallery-empty {
      text-align: center; padding: 4rem 2rem;
      color: var(--muted);
    }
    .gallery-empty .ei { font-size: 3rem; display: block; margin-bottom: 1rem; }
    .gallery-loading { text-align: center; padding: 3rem; color: var(--muted); font-size: 0.9rem; }

    /* â”€â”€ CREDIT FLOAT â”€â”€ */
    #credit-bar {
      position: fixed; bottom: 1.25rem; right: 1.25rem; z-index: 200;
      background: var(--bg3); border: 1px solid var(--border);
      border-radius: 100px; padding: 0.45rem 1.1rem;
      font-size: 0.8rem; color: var(--muted);
      display: flex; align-items: center; gap: 0.4rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    #credit-bar .cc { color: var(--gold2); font-weight: 800; font-size: 0.95rem; }

    /* â”€â”€ FOOTER â”€â”€ */
    footer {
      position: relative; z-index: 1;
      border-top: 1px solid var(--border);
      padding: 2rem; text-align: center;
      font-size: 0.82rem; color: var(--muted);
    }
    footer a { color: var(--muted); transition: color 0.2s; }
    footer a:hover { color: var(--white); }

    /* â”€â”€ MATRIX MODAL OVERLAY â”€â”€ */
    #matrix-canvas {
      position: fixed; inset: 0; z-index: 500;
      pointer-events: none; opacity: 0.15; display: none;
    }
  </style>
</head>
<body>

<!-- BG MATRIX -->
<canvas id="bg-matrix"></canvas>

<!-- NAV -->
<nav>
  <div class="nav-logo">VAF AI Game Generator</div>
  <ul class="nav-links">
    <li><a href="#hero">Studio</a></li>
    <li><a href="#gallery">ğŸŒ Gallery</a></li>
    <li><a href="#" id="nav-cta" class="nav-cta">âš¡ Crea Gioco</a></li>
  </ul>
</nav>

<!-- HERO + INLINE STUDIO -->
<section id="hero">
  <div class="hero-inner">
    <div class="hero-badge">AI Game Studio Engine â€” Early Access</div>
    <h1>Da un'idea a un gioco<br/>giocabile. In 60 secondi.</h1>
    <p class="hero-sub">Descrivi qualsiasi concept â€” VAF genera un HTML5 game completo con AI. Nessun codice, nessun template.</p>

    <!-- STUDIO BOX INLINE -->
    <div class="studio-box" id="studio-box">

      <!-- FORM VIEW -->
      <div id="form-view">
        <div class="studio-title">VAF Studio</div>

        <div class="error-box" id="error-box"></div>
        <div class="complexity-warn" id="complexity-warn">
          <strong>âš ï¸ Concept ambizioso!</strong>
          <p id="complexity-msg">L'AI creerÃ  una versione mini giocabile â€” bilanciata per il browser.</p>
        </div>

        <div class="example-chips" id="example-chips">
          <span class="chip" data-prompt="Sparatutto spaziale: astronave che distrugge ondate di alieni sempre piÃ¹ veloci. Tre vite, power-up, high score.">ğŸš€ Space Shooter</span>
          <span class="chip" data-prompt="Quiz trivia sulla storia d'Italia: 10 domande a scelta multipla, 30 secondi per risposta, punteggio finale.">ğŸ‡®ğŸ‡¹ Quiz Italia</span>
          <span class="chip" data-prompt="Puzzle match-3 con gemme colorate su griglia 8x8. Trascina per abbinare 3+ gemme dello stesso colore. Livelli progressivi.">ğŸ’ Gem Match-3</span>
          <span class="chip" data-prompt="Simulatore guida: percorso con segnali, stop, precedenze. L'utente rispetta le regole del codice della strada.">ğŸš— Guida</span>
          <span class="chip" data-prompt="Platform 2D con personaggio che salta tra piattaforme, evita ostacoli, raccoglie monete. GravitÃ  realistica, 5 livelli.">ğŸƒ Platform</span>
          <span class="chip" data-prompt="Memory card: griglia 4x4 di carte coperte, trova tutte le coppie nel minor numero di mosse. Timer e contatore.">ğŸƒ Memory</span>
        </div>

        <textarea class="concept-textarea" id="concept" placeholder="Descrivi la tua idea... es. Un gioco di corse in cittÃ  dove eviti il traffico e raccogli carburante"></textarea>

        <!-- TIER SELECTOR -->
        <div class="tier-selector" id="tier-selector">
          <div class="tier-card selected" data-tier="quick">
            <span class="tier-badge">QUICK</span>
            <span class="tier-emoji">âš¡</span>
            <div class="tier-name">Quick</div>
            <div class="tier-cost">5 cr</div>
            <div class="tier-desc">Funzionale, grafica semplice</div>
          </div>
          <div class="tier-card" data-tier="enhanced">
            <span class="tier-badge">ENHANCED</span>
            <span class="tier-emoji">ğŸ®</span>
            <div class="tier-name">Enhanced</div>
            <div class="tier-cost">20 cr</div>
            <div class="tier-desc">Grafica curata, animazioni, audio</div>
          </div>
          <div class="tier-card" data-tier="full">
            <span class="tier-badge">FULL GAME</span>
            <span class="tier-emoji">ğŸš€</span>
            <div class="tier-name">Full Game</div>
            <div class="tier-cost">60 cr</div>
            <div class="tier-desc">Shop, livelli, leaderboard, share</div>
          </div>
        </div>

        <div class="studio-footer">
          <div class="credit-badge">ğŸ’ <strong id="balance-display">20</strong> crediti &nbsp;Â·&nbsp; <span id="tier-cost-display">5</span> cr per gioco</div>
          <button class="generate-btn" id="generate-btn">âš¡ Genera Gioco</button>
        </div>
      </div>

      <!-- LOADING VIEW -->
      <div class="gen-loading" id="loading-view">
        <div class="spinner"></div>
        <div>
          <strong>VAF sta costruendo il tuo gioco...</strong>
          <p>L'AI genera logica, meccaniche e assets.<br/>Di solito 30â€“90 secondi.</p>
        </div>
        <div id="loading-steps" style="font-size:0.78rem;color:var(--gold2);"></div>
      </div>

      <!-- RESULT VIEW -->
      <div class="result-panel" id="result-view">
        <div class="studio-title">Gioco pronto âœ“</div>
        <div class="result-meta" id="result-meta"></div>

        <div class="game-preview-box">
          <div class="play-icon">ğŸ®</div>
          <p style="color:var(--muted);font-size:0.88rem;">Gioco generato con successo</p>
          <button class="generate-btn" id="play-btn" style="padding:0.6rem 1.75rem;font-size:0.9rem;">â–¶ Gioca ora</button>
        </div>

        <div class="result-actions">
          <button class="act-primary" id="download-btn">â¬‡ Scarica</button>
          <button class="act-publish" id="publish-toggle-btn">ğŸŒ Pubblica</button>
          <button id="refine-toggle-btn">âœï¸ Modifica</button>
          <button id="new-game-btn">+ Nuovo</button>
        </div>

        <!-- PUBLISH PANEL -->
        <div class="publish-panel" id="publish-panel">
          <input class="pub-input" type="text" id="publish-name" placeholder="Nome del gioco" />
          <input class="pub-input" type="text" id="publish-desc" placeholder="Descrizione breve" />
          <button class="generate-btn" id="publish-btn" style="width:100%;background:linear-gradient(135deg,#d4af37,#c4a35a);">ğŸš€ Pubblica nella Gallery</button>
          <div class="pub-success" id="publish-success">
            <p>âœ… Pubblicato! Ora appare nella Gallery pubblica.</p>
            <div class="pub-link" id="pub-link-display"></div>
          </div>
        </div>

        <!-- REFINE PANEL -->
        <div class="refine-panel" id="refine-panel">
          <textarea class="concept-textarea" id="refine-input" placeholder="Cosa vuoi cambiare? Es. Rendi i nemici piÃ¹ veloci, aggiungi uno scudo..." rows="2" style="margin-bottom:0.6rem;"></textarea>
          <button class="generate-btn" id="refine-btn" style="width:100%;">âš¡ Applica modifica (3 crediti)</button>
        </div>
      </div>

    </div><!-- /studio-box -->

  </div>
</section>

<!-- GALLERY -->
<section id="gallery">
  <div class="gallery-header">
    <h2>Giochi della <span>Community</span> ğŸŒ</h2>
    <button class="btn-refresh" id="gallery-refresh-btn">ğŸ”„ Aggiorna</button>
  </div>
  <div id="gallery-container">
    <div class="gallery-loading">â³ Caricamento...</div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <p>Â© 2025 VAF AI Game Generator Â· <a href="#">Privacy</a> Â· <a href="#">Terms</a> Â· Built on Claude AI</p>
</footer>

<!-- CREDIT BADGE -->
<div id="credit-bar">ğŸ’ <span class="cc" id="credit-display">20</span> crediti</div>

<!-- MATRIX OVERLAY (per animazione) -->
<canvas id="matrix-canvas"></canvas>

<script>
  const API = (location.protocol === 'file:' || location.hostname === '')
    ? 'http://localhost:4000/api'
    : `${location.protocol}//${location.host}/api`;

  // Unique user ID per browser
  let USER_ID = localStorage.getItem('vaf_user_id');
  if (!USER_ID) {
    USER_ID = 'u_' + Math.random().toString(36).substr(2,9) + '_' + Date.now().toString(36);
    localStorage.setItem('vaf_user_id', USER_ID);
  }

  let currentGameId = null;
  let credits = 20;

  const formView     = document.getElementById('form-view');
  const loadingView  = document.getElementById('loading-view');
  const resultView   = document.getElementById('result-view');
  const errorBox     = document.getElementById('error-box');
  const complexWarn  = document.getElementById('complexity-warn');
  const complexMsg   = document.getElementById('complexity-msg');
  const conceptInput = document.getElementById('concept');
  const generateBtn  = document.getElementById('generate-btn');
  const balanceDisp  = document.getElementById('balance-display');
  const creditDisp   = document.getElementById('credit-display');
  const publishPanel = document.getElementById('publish-panel');
  const publishSucc  = document.getElementById('publish-success');
  const refinePanel  = document.getElementById('refine-panel');
  const resultMeta   = document.getElementById('result-meta');

  // â”€â”€ COMPLEXITY â”€â”€
  const COMPLEX_KW = ['gta','grand theft','pokemon','zelda','mario','minecraft','fortnite','call of duty','battlefield','mmorpg','open world','mondo aperto','multiplayer online','real-time strategy','battle royale','massively'];
  function checkComplexity(text) {
    const hit = COMPLEX_KW.find(k => text.toLowerCase().includes(k));
    if (hit) {
      complexMsg.textContent = `"${hit}" Ã¨ un concept molto grande â€” l'AI farÃ  una versione mini giocabile e bilanciata.`;
      complexWarn.classList.add('visible');
    } else {
      complexWarn.classList.remove('visible');
    }
  }
  conceptInput.addEventListener('input', () => checkComplexity(conceptInput.value));

  // â”€â”€ EXAMPLE CHIPS â”€â”€
  document.getElementById('example-chips').addEventListener('click', e => {
    const chip = e.target.closest('.chip');
    if (!chip) return;
    conceptInput.value = chip.dataset.prompt;
    checkComplexity(chip.dataset.prompt);
    conceptInput.focus();
  });

  // â”€â”€ NAV CTA scroll â”€â”€
  document.getElementById('nav-cta').addEventListener('click', e => {
    e.preventDefault();
    document.getElementById('hero').scrollIntoView({ behavior: 'smooth' });
    setTimeout(() => conceptInput.focus(), 500);
  });

  // â”€â”€ BALANCE â”€â”€
  async function fetchBalance() {
    try {
      const res  = await fetch(`${API}/credits/balance`, { headers: { 'x-user-id': USER_ID } });
      const data = await res.json();
      credits = data.credits;
      creditDisp.textContent  = credits;
      balanceDisp.textContent = credits;
    } catch (_) {}
  }

  // â”€â”€ VIEWS â”€â”€
  function showForm()    { formView.style.display='block'; loadingView.classList.remove('visible'); resultView.classList.remove('visible'); }
  function showLoading() {
    formView.style.display='none'; loadingView.classList.add('visible'); resultView.classList.remove('visible');
    const steps = ['Analisi del concept...','Costruzione della logica...','Generazione delle meccaniche...','Creazione degli asset...','Compilazione...','Quasi pronto...'];
    let i = 0; const el = document.getElementById('loading-steps');
    if (window._li) clearInterval(window._li);
    el.textContent = steps[0];
    window._li = setInterval(() => { i = (i+1)%steps.length; el.textContent = steps[i]; }, 5000);
  }
  function showResult() {
    formView.style.display='none'; loadingView.classList.remove('visible'); resultView.classList.add('visible');
    if (window._li) clearInterval(window._li);
  }
  function showError(msg) { errorBox.textContent = msg; errorBox.classList.add('visible'); }
  function clearError()   { errorBox.classList.remove('visible'); }

  // â”€â”€ TIER SELECTOR â”€â”€
  const tierCards = document.querySelectorAll('.tier-card');
  const tierCostDisp = document.getElementById('tier-cost-display');
  const tierCosts = { quick: 5, enhanced: 20, full: 60 };
  tierCards.forEach(card => {
    card.addEventListener('click', () => {
      tierCards.forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      const tier = card.dataset.tier;
      tierCostDisp.textContent = tierCosts[tier] || 5;
    });
  });

  // â”€â”€ GENERATE â”€â”€
  generateBtn.addEventListener('click', async () => {
    clearError();
    const concept = conceptInput.value.trim();
    if (concept.length < 10) { showError('Descrivi il gioco con almeno 10 caratteri.'); return; }
    showLoading();
    try {
      const tier = document.querySelector('.tier-card.selected')?.dataset.tier || 'quick';
      const res  = await fetch(`${API}/generate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-user-id': USER_ID },
        body: JSON.stringify({ concept, tier })
      });
      const data = await res.json();
      if (!res.ok) { showForm(); showError(data.error || 'Generazione fallita. Riprova.'); return; }

      currentGameId = data.gameId;
      credits = data.newCreditBalance;
      creditDisp.textContent = balanceDisp.textContent = credits;

      const tierEmojis = { quick: 'âš¡', enhanced: 'ğŸ®', full: 'ğŸš€' };
      resultMeta.innerHTML = `
        <div class="meta-badge">${tierEmojis[data.tier] || 'âš¡'} <span>${data.tierLabel || data.tier}</span></div>
        <div class="meta-badge">Crediti: <span>${data.creditCost}</span></div>
        <div class="meta-badge">Saldo: <span>${data.newCreditBalance}</span></div>
        <div class="meta-badge">Tempo: <span>${data.generationTimeSeconds}s</span></div>
      `;

      document.getElementById('play-btn').onclick = () => window.open(`${API}/games/${currentGameId}/preview`, '_blank');
      refinePanel.classList.remove('visible');
      publishPanel.classList.remove('visible');
      publishSucc.classList.remove('visible');
      document.getElementById('publish-name').value = '';
      document.getElementById('publish-desc').value = '';
      showResult();
    } catch(e) {
      showForm(); showError('Impossibile connettersi al server.');
    }
  });

  // â”€â”€ DOWNLOAD â”€â”€
  document.getElementById('download-btn').addEventListener('click', () => {
    if (currentGameId) window.open(`${API}/games/${currentGameId}/download`, '_blank');
  });

  // â”€â”€ NEW GAME â”€â”€
  document.getElementById('new-game-btn').addEventListener('click', () => {
    currentGameId = null; conceptInput.value = '';
    complexWarn.classList.remove('visible');
    showForm(); fetchBalance();
  });

  // â”€â”€ PUBLISH TOGGLE â”€â”€
  document.getElementById('publish-toggle-btn').addEventListener('click', () => {
    publishPanel.classList.toggle('visible');
    refinePanel.classList.remove('visible');
  });

  // â”€â”€ PUBLISH â”€â”€
  document.getElementById('publish-btn').addEventListener('click', async () => {
    if (!currentGameId) return;
    const name = document.getElementById('publish-name').value.trim() || 'Il mio gioco VAF';
    const desc = document.getElementById('publish-desc').value.trim() || '';
    const btn  = document.getElementById('publish-btn');
    btn.disabled = true; btn.textContent = 'Pubblicazione...';
    try {
      const res  = await fetch(`${API}/games/${currentGameId}/publish`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json', 'x-user-id': USER_ID },
        body: JSON.stringify({ name, description: desc })
      });
      const data = await res.json();
      if (!res.ok) { alert(data.error || 'Errore.'); return; }
      const link = `${location.protocol}//${location.host}${data.previewUrl}`;
      document.getElementById('pub-link-display').textContent = link;
      publishSucc.classList.add('visible');
      btn.style.display = 'none';
      loadGallery();
    } catch(e) { alert('Errore pubblicazione.'); }
    finally { btn.disabled = false; if (btn.style.display !== 'none') btn.textContent = 'ğŸš€ Pubblica nella Gallery'; }
  });

  // â”€â”€ REFINE TOGGLE â”€â”€
  document.getElementById('refine-toggle-btn').addEventListener('click', () => {
    refinePanel.classList.toggle('visible');
    publishPanel.classList.remove('visible');
  });

  // â”€â”€ REFINE â”€â”€
  document.getElementById('refine-btn').addEventListener('click', async () => {
    const refinementPrompt = document.getElementById('refine-input').value.trim();
    if (!refinementPrompt || !currentGameId) return;
    const btn = document.getElementById('refine-btn');
    btn.disabled = true; btn.textContent = 'Elaborazione...';
    try {
      const res  = await fetch(`${API}/generate/refine`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-user-id': USER_ID },
        body: JSON.stringify({ gameId: currentGameId, refinementPrompt })
      });
      const data = await res.json();
      if (!res.ok) { alert(data.error || 'Refinement fallito.'); return; }
      credits = data.newCreditBalance;
      creditDisp.textContent = balanceDisp.textContent = credits;
      document.getElementById('refine-input').value = '';
      refinePanel.classList.remove('visible');
    } catch(e) { alert('Errore connessione.'); }
    finally { btn.disabled = false; btn.textContent = 'âš¡ Applica modifica (3 crediti)'; }
  });

  // â”€â”€ GALLERY â”€â”€
  const EMOJIS = ['ğŸ®','ğŸš€','ğŸƒ','ğŸ’','ğŸƒ','ğŸš—','âš”ï¸','ğŸ¯','ğŸ§©','ğŸŒŸ','ğŸ‘¾','ğŸ²','ğŸ†','ğŸ”«','ğŸ‰','ğŸ¦Š','ğŸŒˆ','ğŸª'];

  async function loadGallery() {
    const container = document.getElementById('gallery-container');
    container.innerHTML = '<div class="gallery-loading">â³ Caricamento giochi...</div>';
    try {
      const res  = await fetch(`${API}/games/public`);
      const data = await res.json();

      if (!data.games || data.games.length === 0) {
        container.innerHTML = `<div class="gallery-empty">
          <span class="ei">ğŸ®</span>
          <p>Nessun gioco pubblicato ancora â€” sii il primo!</p>
        </div>`;
        return;
      }

      const grid = document.createElement('div');
      grid.className = 'gallery-grid';

      data.games.forEach((game, idx) => {
        const emoji = EMOJIS[idx % EMOJIS.length];
        const name  = (game.name || game.concept).substring(0, 48);
        const desc  = (game.description || game.concept).substring(0, 90);
        const safeC = game.concept.replace(/"/g,'&quot;').replace(/'/g,'&#39;');

        const card = document.createElement('div');
        card.className = 'gallery-card';
        card.innerHTML = `
          <div class="gallery-thumb" onclick="window.open('${API}/games/${game.id}/preview','_blank')">${emoji}</div>
          <div class="gallery-body">
            <h3 title="${name}">${name}</h3>
            <p>${desc}</p>
            <div class="gallery-actions">
              <a class="btn-play" href="${API}/games/${game.id}/preview" target="_blank">â–¶ Gioca</a>
              <button class="btn-remix" data-concept="${safeC}">ğŸ”€ Remix</button>
            </div>
          </div>`;
        grid.appendChild(card);
      });

      container.innerHTML = '';
      container.appendChild(grid);

      container.querySelectorAll('.btn-remix').forEach(btn => {
        btn.addEventListener('click', () => {
          conceptInput.value = 'REMIX â€” ' + btn.dataset.concept;
          checkComplexity(btn.dataset.concept);
          document.getElementById('hero').scrollIntoView({ behavior: 'smooth' });
          setTimeout(() => conceptInput.focus(), 400);
          showForm();
        });
      });
    } catch(e) {
      container.innerHTML = '<div class="gallery-empty"><span class="ei">âš ï¸</span><p>Errore caricamento gallery.</p></div>';
    }
  }

  document.getElementById('gallery-refresh-btn').addEventListener('click', loadGallery);

  // â”€â”€ MATRIX BG â”€â”€
  (function() {
    const c = document.getElementById('bg-matrix');
    const ctx = c.getContext('2d');
    function resize() { c.width = window.innerWidth; c.height = window.innerHeight; }
    resize(); window.addEventListener('resize', resize);
    const chars = 'VAFAIã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­01Î”Î£âˆâ‰ˆ><{}[]01110010';
    const fs = 13; let cols = Math.floor(c.width/fs);
    let drops = Array(cols).fill(0);
    setInterval(() => {
      cols = Math.floor(c.width/fs);
      if (drops.length < cols) drops = [...drops, ...Array(cols-drops.length).fill(0)];
      ctx.fillStyle = 'rgba(0,0,0,0.08)';
      ctx.fillRect(0,0,c.width,c.height);
      ctx.font = fs+'px monospace';
      for (let i = 0; i < cols; i++) {
        const ch = chars[Math.floor(Math.random()*chars.length)];
        const r = Math.random();
        if (r > 0.96)      ctx.fillStyle = '#d4af37';
        else if (r > 0.90) ctx.fillStyle = '#a855f7';
        else if (r > 0.75) ctx.fillStyle = '#c4c4c8';
        else               ctx.fillStyle = '#e8e8ec';
        ctx.fillText(ch, i*fs, drops[i]*fs);
        if (drops[i]*fs > c.height && Math.random() > 0.978) drops[i] = 0;
        drops[i]++;
      }
    }, 45);
  })();

  // â”€â”€ INIT â”€â”€
  fetchBalance();
  loadGallery();
</script>
</body>
</html>
